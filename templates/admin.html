{% extends "base.html" %}

{% block title %}Admin Dashboard - Learning Activity System{% endblock %}

{% block content %}
<div class="container" style="margin-top: 2rem;">
    <div class="flex-between mb-4">
        <h1>Admin Dashboard</h1>
        <a href="{{ url_for('auth.logout') }}" class="btn btn-danger">Logout</a>
    </div>
    
    <!-- Statistics Overview -->
    <div class="grid grid-3 mb-4">
        <div class="stat-card">
            <div class="stat-value">{{ stats.total_teachers }}</div>
            <div class="stat-label">Total Teachers</div>
        </div>
        <div class="stat-card" style="background: linear-gradient(135deg, #10b981, #059669);">
            <div class="stat-value">{{ stats.total_activities }}</div>
            <div class="stat-label">Total Activities</div>
        </div>
        <div class="stat-card" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
            <div class="stat-value">{{ stats.total_students or 0 }}</div>
            <div class="stat-label">Total Students</div>
        </div>
    </div>
    
    <!-- Activity Type Breakdown -->
    <div class="card mb-4">
        <div class="card-header">
            <h2>Activity Type Distribution</h2>
        </div>
        <div class="card-body">
            <div class="grid grid-3">
                <div class="text-center p-3">
                    <div style="font-size: 2rem; margin-bottom: 0.5rem;">üìä</div>
                    <div style="font-size: 1.5rem; font-weight: bold; color: var(--primary-color);">
                        {{ stats.poll_count }}
                    </div>
                    <div style="color: #6b7280;">Polls</div>
                </div>
                <div class="text-center p-3">
                    <div style="font-size: 2rem; margin-bottom: 0.5rem;">‚úçÔ∏è</div>
                    <div style="font-size: 1.5rem; font-weight: bold; color: var(--success-color);">
                        {{ stats.short_answer_count }}
                    </div>
                    <div style="color: #6b7280;">Short Answers</div>
                </div>
                <div class="text-center p-3">
                    <div style="font-size: 2rem; margin-bottom: 0.5rem;">‚òÅÔ∏è</div>
                    <div style="font-size: 1.5rem; font-weight: bold; color: var(--warning-color);">
                        {{ stats.word_cloud_count }}
                    </div>
                    <div style="color: #6b7280;">Word Clouds</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Recent Teachers -->
    <div class="card">
        <div class="card-header">
            <h2>Recent Teachers</h2>
        </div>
        <div class="card-body">
            {% if recent_teachers %}
            <table class="table">
                <thead>
                    <tr>
                        <th>Username</th>
                        <th>Email</th>
                        <th>Institution</th>
                        <th>Courses</th>
                        <th>Registered</th>
                        <th>Last Login</th>
                    </tr>
                </thead>
                <tbody>
                    {% for teacher in recent_teachers %}
                    <tr>
                        <td>{{ teacher.username }}</td>
                        <td>{{ teacher.email }}</td>
                        <td>{{ teacher.institution or '-' }}</td>
                        <td>{{ teacher.course_count }}</td>
                        <td>{{ teacher.created_at.strftime('%Y-%m-%d') }}</td>
                        <td>{{ teacher.last_login.strftime('%Y-%m-%d') if teacher.last_login else 'Never' }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p style="text-align: center; color: #6b7280; padding: 2rem;">
                No teachers registered yet
            </p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Refresh stats every 30 seconds
setInterval(async () => {
    try {
        const result = await apiCall('{{ url_for("admin.get_stats") }}');
        if (result.success) {
            // Update stats dynamically (optional)
            console.log('Stats updated:', result.stats);
        }
    } catch (error) {
        console.error('Failed to refresh stats');
    }
}, 30000);
</script>
{% endblock %}
